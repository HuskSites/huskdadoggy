<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      :root {
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --accent: #00d2ff;
      }

      * { box-sizing: border-box; }

      body, html {
        margin: 0; padding: 0; height: 100%;
        font-family: 'Inter', sans-serif;
        overflow: hidden; color: white;
        background: #0b0e14;
      }

      .bg-container {
        position: fixed; inset: 0; z-index: -1;
        background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
      }

      @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      #loading-screen {
        position: fixed; inset: 0; background: #0b0e14;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 9999; transition: opacity 0.8s ease-out, visibility 0.8s;
      }

      .loader {
        width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.1);
        border-top-color: var(--accent); border-radius: 50%;
        animation: spin 1s linear infinite; margin-bottom: 15px;
      }

      @keyframes spin { to { transform: rotate(360deg); } }

      .container {
        display: flex; justify-content: center; align-items: center;
        height: 100vh; opacity: 0; transition: opacity 1s ease;
      }

      .card {
        background: var(--glass-bg);
        backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--glass-border);
        padding: 30px; border-radius: 24px;
        width: 95%; max-width: 500px; text-align: left;
      }

      h1 { font-weight: 800; margin-bottom: 15px; font-size: 22px; color: var(--accent); }
      
      .rules-list {
        max-height: 280px; overflow-y: auto;
        padding-right: 12px; margin-bottom: 20px;
      }

      .rules-list::-webkit-scrollbar { width: 4px; }
      .rules-list::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }

      .rule-item {
        margin-bottom: 14px; font-size: 12.5px; line-height: 1.5;
        padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);
      }

      .rule-item strong { color: #fff; display: block; margin-bottom: 3px; font-size: 13px; }

      .agree-box {
        padding: 12px; background: rgba(0,0,0,0.3);
        border-radius: 12px; display: flex; align-items: center;
        gap: 12px; cursor: pointer; border: 1px solid var(--glass-border);
      }

      button {
        width: 100%; padding: 15px; margin-top: 15px;
        border-radius: 12px; border: none;
        background: var(--accent); color: #000;
        font-weight: bold; cursor: pointer; text-transform: uppercase;
      }

      button:disabled { opacity: 0.3; cursor: not-allowed; }

      .link-display {
        background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px;
        font-family: monospace; font-size: 12px; margin-top: 15px;
        word-break: break-all; border: 1px solid var(--accent);
      }
    </style>
  </head>
  <body>

    <div id="loading-screen">
      <div class="loader"></div>
      <p id="loading-text">Loading Guidelines...</p>
    </div>

    <div class="bg-container"></div>

    <div class="container" id="main-content">
      <div class="card">
        <h1>Discord Compliance & Rules</h1>
        
        <div class="rules-list">
          <div class="rule-item">
            <strong>1. Discord Terms of Service</strong>
            By entering, you agree to abide by the official Discord ToS and Community Guidelines. Failure to do so will result in an immediate ban.
          </div>
          <div class="rule-item">
            <strong>2. Age Requirements</strong>
            You must be at least 13+ to join. We follow all COPPA and regional age safety laws.
          </div>
          <div class="rule-item">
            <strong>3. No Illegal Activities</strong>
            Do not organize or share malware, doxxing, or illegal content.
          </div>
          <div class="rule-item">
            <strong>4. Zero Tolerance Hate Speech</strong>
            No discrimination based on race, religion, or orientation.
          </div>
          <div class="rule-item">
            <strong>5. No Raiding</strong>
            Interfering with other servers or Discord services is strictly prohibited.
          </div>
        </div>
        
        <div class="agree-box" onclick="document.getElementById('agreeCheck').click()">
          <input type="checkbox" id="agreeCheck" onchange="toggleBtn()">
          <span style="font-size: 12px; opacity: 0.9;">I certify I am 13+ and agree to the Rules.</span>
        </div>

        <button id="submitBtn" disabled onclick="submitData()">Verify & Copy Link</button>
      </div>
    </div>

    <script>
      const DISCORD_LINK = "https://discord.gg/DqcYkUDUzm";

      // 1. Fixed Loading Sequence
      window.onload = () => {
        const statuses = ["Syncing ToS...", "Checking Compliance...", "Ready"];
        let i = 0;
        const interval = setInterval(() => {
          const txt = document.getElementById('loading-text');
          if(txt) txt.innerText = statuses[i];
          i++;
          if(i >= statuses.length) {
            clearInterval(interval);
            fadeOutLoader();
          }
        }, 600);
      };

      function fadeOutLoader() {
        const loader = document.getElementById('loading-screen');
        const main = document.getElementById('main-content');
        if(loader) loader.style.opacity = '0';
        setTimeout(() => {
          if(loader) loader.style.visibility = 'hidden';
          if(main) main.style.opacity = '1';
        }, 800);
      }

      function toggleBtn() {
        const check = document.getElementById('agreeCheck');
        document.getElementById('submitBtn').disabled = !check.checked;
      }

      async function copyToClipboard() {
        try {
          await navigator.clipboard.writeText(DISCORD_LINK);
          const copyBtn = document.getElementById('copyBtn');
          copyBtn.innerText = "COPIED!";
          copyBtn.style.background = "#00ff88";
          setTimeout(() => {
            copyBtn.innerText = "Copy Link Again";
            copyBtn.style.background = "var(--accent)";
          }, 2000);
        } catch (err) {
          alert("Manual Link: " + DISCORD_LINK);
        }
      }

      function submitData() {
        const btn = document.getElementById('submitBtn');
        btn.innerText = "VERIFYING...";
        btn.disabled = true;

        // Check if running inside Google Apps Script
        if (typeof google !== 'undefined' && google.script && google.script.run) {
          google.script.run
            .withSuccessHandler(showSuccess)
            .withFailureHandler(() => {
                alert("Server error, but proceeding to link...");
                showSuccess();
            })
            .recordAgreement(); 
        } else {
          // Local/Browser testing fallback
          setTimeout(showSuccess, 1000);
        }
      }

      function showSuccess() {
        const card = document.querySelector('.card');
        card.style.textAlign = "center";
        card.innerHTML = `
          <h1 style="color: #00ff88;">âœ“ Verified</h1>
          <p style="font-size: 13px;">Agreement recorded. Copy the invite below:</p>
          <div class="link-display">${DISCORD_LINK}</div>
          <button id="copyBtn" onclick="copyToClipboard()">Copy Invite Link</button>
        `;
      }
    </script>
  </body>
</html>
